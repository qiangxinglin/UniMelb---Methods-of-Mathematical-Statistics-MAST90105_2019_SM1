---
title: "Assignment 4"
author: "Vinh Nguyen (ID 1029531)"
output: html_notebook
---


```{r}
# Preliminaries
.rs.restartR()
rm(list=ls())
```

## Problem 1.
Carbon monoxide concentrations (in µg/m3
) are measured on 6 different days in city
A and on 4 different days in city B. The following measurements have been obtained
in cities A and B, respectively: 3.9, 4.7, 7.1, 6.9, 4.3, 6.3 and 7.3, 6.9, 7.6, 9.1. We
assume that these two samples are independent.
(a) Assume that both samples are from normally distributed populations. We also
assume that the same type of measurement device was used in both cities so that
the measurement error (variance) is the same for both samples. Construct the
95% confidence interval for δ = µA−µB where µA and µB are mean concentrations
of carbon monoxide in cities A and B, respectively.  
Let $X_1, X_2, \dots , X_6$: monoxide concentrations (in µg/m3
) are measured on 6 different days in city A; $\overline{X}$: sample mean in A  
$Y_1, Y_2, \dots , Y_4$: monoxide concentrations (in µg/m3
) are measured on 4 different days in city B; $\overline{Y}$: sample mean in B  
Estimator for δ = µA−µB:  
$$
\begin{align}
\hat{\Delta} &= \overline{X} - \overline{Y} \sim N(\mu_\hat{\Delta}, \sigma^2_\hat{\Delta}) \\
\end{align}
$$
where $\overline{X}, \overline{Y}$ normally distributed ($X_i, Y_i$ normal)  
$$
\begin{align}
\mu_\hat{\Delta} &= E(\overline{X} - \overline{Y}) \\
&= E(\overline{X}) - E(\overline{Y}) \\
&= \mu_A - \mu_B \\
\sigma^2_\hat{\Delta} &= var(\overline{X} - \overline{Y}) \\
&= var(\overline{X}) + var(\overline{Y}) \\
&= \frac{1}{6}\sigma^2 + \frac{1}{4}\sigma^2 \\
&= \bigg(\frac{1}{6} + \frac{1}{4}\bigg)\sigma^2 \quad (\sigma^2 = var(X_i) = var(Y_i)) \\
\end{align}
$$
$$
\begin{align}
\hat{\Delta} &\sim N\bigg(\mu_A - \mu_B, \bigg(\frac{1}{6} + \frac{1}{4}\bigg)\sigma^2\bigg) \\
\end{align}
$$
Standard normal variable:  
$$
\begin{align}
Z = \frac{\hat{\Delta} - (\mu_A - \mu_B)}{\sqrt{\bigg(\frac{1}{6} + \frac{1}{4}\bigg)\sigma^2}} &\sim N(0, 1) \\
\end{align}
$$
Chi-squared variable:  
$$
\begin{align}
U = 5\frac{S_X}{\sigma^2} + 3\frac{S_Y}{\sigma^2} &\sim \chi^2_8 \\
\end{align}
$$
where $S_X, S_Y$ are sample variances in cities A and B respectively.  
Student's t-distribution:  
$$
\begin{align}
T &= \frac{Z}{\sqrt{\frac{U}{8}}} \\
&= \frac{\frac{\hat{\Delta} - (\mu_A - \mu_B)}{\sqrt{\big(\frac{1}{6} + \frac{1}{4}\big)\sigma^2}}}{\sqrt{\frac{5\frac{S_X}{\sigma^2} + 3\frac{S_Y}{\sigma^2}}{8}}} \\
&= \frac{\hat{\Delta} - (\mu_A - \mu_B)}{\sqrt{\frac{25}{96} S_X + \frac{5}{32} S_Y}} \sim t_8 \\
\end{align}
$$
**95% confidence interval**  
$$
\begin{align}
P(−t_0 ≤ T ≤ t_0) &= 0.95 \\
P\Bigg(−t_0 ≤ \frac{\hat{\Delta} - (\mu_A - \mu_B)}{\sqrt{\frac{25}{96} S_X + \frac{5}{32} S_Y}} ≤ t_0\Bigg) &= 0.95 \\
P\Bigg(\hat{\Delta} - t_0 \sqrt{\frac{25}{96} S_X + \frac{5}{32} S_Y} \leq \mu_A - \mu_B \leq \hat{\Delta} + t_0 \sqrt{\frac{25}{96} S_X + \frac{5}{32} S_Y}\Bigg) &= 0.95 \\
\end{align}
$$
$$
\begin{align}
\Rightarrow CI_{0.95} = \Bigg[\hat{\Delta} - t_0 \sqrt{\frac{25}{96} S_X + \frac{5}{32} S_Y}, \hat{\Delta} + t_0 \sqrt{\frac{25}{96} S_X + \frac{5}{32} S_Y}\Bigg] \quad (\hat{\Delta} = \overline{X} - \overline{Y}, t_0 = q_{0.975}) \\
\end{align}
$$
```{r}
x <- c(3.9, 4.7, 7.1, 6.9, 4.3, 6.3)
y <- c(7.3, 6.9, 7.6, 9.1)

x_mean <- mean(x)
y_mean <- mean(y)
x_var <- var(x)
y_var <- var(y)
t0 <- qt(0.975, df=8)

"Observed confidence interval"
confint1 <- (x_mean - y_mean) + t0 * sqrt(25/96*x_var + 5/32*y_var) * c(-1, 1)
confint1
```

(b) Do we reject H0 : δ = 0 in favor of H1 : δ 6= 0 at the 5% significance level? Why
or why not? Find the p-value of this test.  
**Reject H0 (0 outside of observed confidence interval)?**  
```{r}
0 < confint1[1] | 0 > confint1[2]
```
Test statistic:  
$$
\begin{align}
T &= \frac{\hat{\Delta} - (\mu_A - \mu_B)}{\sqrt{\frac{25}{96} S_X + \frac{5}{32} S_Y}} \sim t_8 \\
\end{align}
$$
**p-value**  
$$
\begin{align}
P\Bigg(|T| \geq \Bigg|\frac{\hat{\delta}}{\sqrt{\frac{25}{96} s_X + \frac{5}{32} s_Y}}\Bigg| \ |\ \mu_A - \mu_B = 0\Bigg) &= 2P\Bigg(T \geq \Bigg|\frac{\hat{\delta}}{\sqrt{\frac{25}{96} s_X + \frac{5}{32} s_Y}}\Bigg| \ |\ \mu_A - \mu_B = 0\Bigg) \quad (T \sim t_8, \hat{\delta} = \overline{x} - \overline{y}) \\
\end{align}
$$
```{r}
"p-value"
test_stat <- x_mean - y_mean / sqrt(25/96*x_var + 5/32*y_var) # test statistic
p_val <- 2 * pt(abs(test_stat), df=8, lower.tail = FALSE)
p_val
```

(c) Now assume that both samples are from normally distributed populations, as
before, but two different measurement devices were used and their measurements
errors are known. We assume that the variances are 2 and 1, respectively, for the
two samples. Construct the 95% confidence interval for δ.  
Recall estimator for δ = µA−µB:  
$$
\begin{align}
\hat{\Delta} &= \overline{X} - \overline{Y} \sim N(\mu_\hat{\Delta}, \sigma^2_\hat{\Delta}) \\
\end{align}
$$
where $\overline{X}, \overline{Y}$ normally distributed ($X_i, Y_i$ normal)  
$$
\begin{align}
\mu_\hat{\Delta} &= \mu_A - \mu_B \\
\sigma^2_\hat{\Delta} &= var(\overline{X} - \overline{Y}) \\
&= var(\overline{X}) + var(\overline{Y}) \\
&= \frac{1}{6}\sigma_X^2 + \frac{1}{4}\sigma_Y^2 \\
\end{align}
$$
$$
\begin{align}
\hat{\Delta} &= \overline{X} - \overline{Y} \sim N(\mu_A - \mu_B, \frac{1}{6}\sigma_X^2 + \frac{1}{4}\sigma_Y^2) \\
\end{align}
$$
Standard normal variable:  
$$
\begin{align}
Z = \frac{\hat{\Delta} - (\mu_A - \mu_B)}{\sqrt{\frac{1}{6}\sigma_X^2 + \frac{1}{4}\sigma_Y^2}} &\sim N(0, 1) \\
\end{align}
$$
**95% confidence interval**  
$$
\begin{align}
P\Bigg(lb \leq Z = \frac{\hat{\Delta} - (\mu_A - \mu_B)}{\sqrt{\frac{1}{6}\sigma_X^2 + \frac{1}{4}\sigma_Y^2}} \leq ub\Bigg) = 0.95 \\
P\Bigg(-z_{0.025} \leq Z = \frac{\hat{\Delta} - (\mu_A - \mu_B)}{\sqrt{\frac{1}{6}\sigma_X^2 + \frac{1}{4}\sigma_Y^2}} \leq z_{0.025}\Bigg) = 0.95 \\
\Rightarrow CI_{0.95} = \Bigg[\hat{\Delta} - z_{0.025} \sqrt{\frac{1}{6}\sigma_X^2 + \frac{1}{4}\sigma_Y^2}, \hat{\Delta} + z_{0.025} \sqrt{\frac{1}{6}\sigma_X^2 + \frac{1}{4}\sigma_Y^2}\Bigg] \quad (\hat{\Delta} &= \overline{X} - \overline{Y}) \\
\end{align}
$$
```{r}
"Observed confidence interval"
confint2 <- (x_mean - y_mean) + qnorm(1-0.025) * sqrt(1/6*2 + 1/4*1) * c(-1, 1)
confint2
```

(d) Compare confidence intervals you obtained in (a) and (c). Which one is narrower?
Briefly explain why.  
**Narrower CI**  
```{r}
conf_span1 <- confint1[2] - confint1[1] # CI in (a)
conf_span2 <- confint2[2] - confint2[1] # CI in (c)
if (conf_span1 < conf_span2) "CI in (a)" else "CI in (c)"
```
This is due to the fact that the approach in (a) employs more approximation (via the use of t-distribution), hence the resulted greater uncertainty (larger span) in the confidence interval. Concretely, t-distribution has thicker tails than normal distribution, resulting in t-quantile > normal quantile for same confidence level 95% ($t_0 > z_{0.025}$), thus t-approximation CI (a) tends to be wider than known-variance CI (c).  

(e) Show that (3.9, 7.1) is an approximate 97% confidence interval for the median
concentration of carbon monoxide in city A.  
Sort measurements in city A:  
```{r}
x_sorted <- sort(x)
x_sorted
```
Order statistics of confidence interval:  
```{r}
orders <- match(c(3.9, 7.1), x_sorted)
orders
```
Let W: number of $X_{(i)} \leq m \Rightarrow W \sim Bi(n=6, p=0.5)$  
**Confidence level**  
```{r}
sprintf("P(X(%s) <= m <= X(%s))", orders[1], orders[2])
sprintf("P(%s <= W <= %s)", orders[1], orders[2]-1)
pbinom(orders[2]-1, size=6, prob=0.5) - pbinom(orders[1]-1, size=6, prob=0.5)
```

## Problem 2.
Let X1, X2, . . . , X10 be a sample of size 10 from an exponential distribution with the
density function
f(x; λ) = (
λe−λx, x > 0,
0, otherwise.
We reject H0 : λ = 1 in favor of H1 : λ = 2 if the observed value of Y =
P10
i=1 Xi
is
smaller than 6.
(a) Find the probability of type 1 error for this test.  
$$
\begin{align}
Y = \sum_{i=1}^{10}X_i \sim Gamma(\alpha=10, \beta=\lambda) \\
\end{align}
$$
**Type 1 error**  
$$
\begin{align}
P(Y < 6|λ = 1) \\
\end{align}
$$
```{r}
type1 <- pgamma(6, shape=10, rate = 1)
type1
```

(b) Find the probability of type 2 error for this test.  
**Type 2 error**  
$$
\begin{align}
P(Y \geq 6|λ = 2) \\
\end{align}
$$
```{r}
type2 <- pgamma(6, shape=10, rate = 2, lower.tail = FALSE)
type2
```

(c) Let y = 5 be the observed value of Y . Find the p-value for this test.  
**p-value**  
$$
\begin{align}
P(Y < 5|λ = 1) \\
\end{align}
$$
```{r}
pgamma(5, shape=10, rate = 1)
```

(d) Let y = 5 be the observed value of Y . Construct the exact 95% confidence interval
for λ. Hint: λY ∼ Gamma(10, 1).  
Pivot  
$$
\begin{align}
λY ∼ Gamma(\alpha=10, \beta=1) \\
\end{align}
$$
**95% confidence interval**  
$$
\begin{align}
P(q_{0.05} \leq λY < \infty) &= 0.95 \\
P(\frac{q_{0.05}}{Y} \leq λ < \infty) &= 0.95 \\
\Rightarrow CI_{0.95} = [\frac{q_{0.05}}{Y}, \infty] \\
\end{align}
$$
```{r}
q <- qgamma(0.05, shape=10, rate = 1)
"Observed 95% confidence interval"
c(q/5, Inf)
```

## Problem 3.
The number of faults over a period of time was collected for a sample of 100 datatransmission lines. We want to test if the data come from a Poisson distribution.  
number of faults 0 1 2 3 4 5 > 5  
number of lines 38 30 16 9 5 2 0  
(a) Assuming the number of faults for a data-transmission line, Yi
, i = 1, . . . , 100,
follows a Poisson distribution with parameter λ, find the maximum likelihood
estimate of λ for these data.  
Let $y = (y_1, \dots, y_{100})$  
Maximum Likelihood function:  
$$
\begin{align}
\mathcal{L}(y) &= \prod_{i=1}^{100} f_{Y_i}(y_i) \\
&= \prod_{i=1}^{100} \frac{\lambda^{y_i} e^{-\lambda}}{y_i!} \\
&= C \lambda^{\sum_{i=1}^{100}y_i} e^{-100\lambda} \quad \bigg(C = \prod_{i=1}^{100} \frac{1}{y_i!}\bigg) \\
ln \mathcal{L}(y) &= lnC + \sum_{i=1}^{100}y_i ln\lambda - 100\lambda \\
\frac{d ln \mathcal{L}(y)}{d\lambda} &= \sum_{i=1}^{100}y_i \frac{1}{\lambda} - 100 \stackrel{set}{=} 0 \\
\Rightarrow \lambda &= \frac{1}{100} \sum_{i=1}^{100}y_i = \overline{y} \\
\end{align}
$$
$$
\begin{align}
\frac{d^2 ln \mathcal{L}(y)}{(d\lambda)^2} &= -\frac{1}{\lambda^2} \sum_{i=1}^{100}y_i < 0 \\
\end{align}
$$
**Estimator for λ**  
$$
\begin{align}
\hat{\Lambda} &= \frac{1}{100} \sum_{i=1}^{100}Y_i = \overline{Y} \\
\end{align}
$$
```{r}
faults <- c(0, 1, 2, 3, 4, 5, Inf) # Inf represents > 5
counts <- c(38, 30, 16, 9, 5, 2, 0)
"Estimate of λ"
lambda <- weighted.mean(faults, counts)
lambda
```

(b) Test the hypothesis that the number of faults for a data-transmission line follows
a Poisson distribution using the chi-squared test. Do we reject the null hypothesis
at the 5% significance level? Hint: You should combine the observed data into
several groups such that expected frequencies are greater or equal to 5 for each
group.  
Raw expected frequencies $np_{Y_i}(k), k = 0, 1, 2, \dots$  
```{r}
n <- 100 # sample size
n * dpois(0:5, lambda = lambda)
```
Groups (with expected frequencies greater or equal to 5)  
```{r}
sep <- 3 # number of points that remain separate

groups <- c(faults[1:sep], Inf) # Inf represents the remaining values of faults (upper tail)
groups

observed <- c(counts[1:sep], sum(counts[-(1:sep)])) # few first counts remain separate, remaining counts are summed up
observed
```
Chi-squared test:  
```{r}
"Probability distribution"
pmfs <- c(dpois(faults[1:sep], lambda = lambda), ppois(faults[sep], lambda = lambda, lower.tail = FALSE)
)
pmfs

"Expected frequencies >= 5?"
expected <- n * pmfs
all(expected >= 5)

"Degrees of freedom"
df <- (length(groups) - 1) - (1)
df

"Test statistic"
chi_stat <- sum((observed-expected)^2 / expected)
chi_stat

"p-value"
p_val <- pchisq(chi_stat, df = df, lower.tail = FALSE)
p_val

"Reject the null hypothesis at the 5% significance level?"
p_val < 0.05
```
